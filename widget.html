<div class="payslips-widget" data-state="hidden">
  <!-- Header -->
  <div class="pw-header">
    <h1 class="pw-title">My Payslips</h1>

    <button class="pw-privacy-toggle" type="button" aria-label="View payslips">
      <span class="pw-eye" aria-hidden="true">
        <!-- eye icon -->
        <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8S1 12 1 12z"></path>
          <circle cx="12" cy="12" r="3"></circle>
        </svg>
      </span>
      <span class="pw-privacy-text">Tap to view</span>
    </button>
  </div>

  <!-- Tabs -->
  <div class="pw-tabs" role="tablist" aria-label="Payslip months">
    <button class="pw-tab is-active" role="tab" aria-selected="true" data-month="june2020">June 2020</button>
    <button class="pw-tab" role="tab" aria-selected="false" data-month="may2020">May 2020</button>
    <button class="pw-tab" role="tab" aria-selected="false" data-month="apr2020">April 2020</button>
    <button class="pw-tab" role="tab" aria-selected="false" data-month="mar2020">March 2020</button>
  </div>

  <!-- Content (blurred when hidden) -->
  <div class="pw-content">
    <!-- Summary card -->
    <section class="pw-card pw-summary" aria-label="Payslip summary">
      <div class="pw-summary-top">
        <div class="pw-label">Net Pay</div>
        <div class="pw-net" data-bind="net">$5,250.91</div>
      </div>

      <div class="pw-summary-bottom">
        <div class="pw-metric">
          <div class="pw-label">Gross Pay</div>
          <div class="pw-value" data-bind="gross">$7,430.00</div>
        </div>
        <div class="pw-divider" aria-hidden="true"></div>
        <div class="pw-metric">
          <div class="pw-label">Deductions</div>
          <div class="pw-value" data-bind="deductions">$2,179.09</div>
        </div>
      </div>
    </section>

    <!-- List -->
    <h2 class="pw-section-title">Payslips</h2>

    <section class="pw-card pw-list" aria-label="Payslip list" data-bind="list">
      <!-- injected -->
    </section>
  </div>

  <!-- Privacy overlay -->
  <div class="pw-overlay" aria-hidden="true">
    <div class="pw-overlay-inner">
      <div class="pw-overlay-text">
        <div class="pw-overlay-title">Tap to view</div>
        <div class="pw-overlay-subtitle">your payslips</div>
      </div>

      <button class="pw-overlay-btn" type="button" aria-label="View payslips">
        <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8S1 12 1 12z"></path>
          <circle cx="12" cy="12" r="3"></circle>
        </svg>
      </button>
    </div>
  </div>
</div>

<style>
  .payslips-widget{
    --bg:#ffffff;
    --card:#f6f7f8;
    --card2:#f3f4f6;
    --text:#0f172a;
    --muted:#6b7280;
    --blue:#2f6fb2;
    --blue-weak:#cfe0f5;
    --green:#1f7a4a;
    --border:#e5e7eb;

    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    color: var(--text);
    max-width: 420px;
    background: var(--bg);
    border-radius: 18px;
    padding: 18px;
    border: 1px solid #eef0f3;
    position: relative;
    overflow: hidden;
  }

  /* Header */
  .pw-header{display:flex;align-items:center;justify-content:space-between;gap:12px;}
  .pw-title{font-size: 38px;line-height:1.05;margin:0;font-weight:800;letter-spacing:-0.02em;}
  .pw-privacy-toggle{
    display:flex;align-items:center;gap:10px;
    border:0;background:transparent;color:#1e4e8c;
    font-weight:700;font-size:18px;cursor:pointer;
    padding:10px 12px;border-radius:14px;
  }
  .pw-privacy-toggle:hover{background:#f2f6ff;}
  .pw-eye{
    width:44px;height:44px;border-radius:999px;
    background: var(--blue);
    border: 2px solid #1e4e8c;
    display:grid;place-items:center;
    color:#0e3e73;
  }

  /* Tabs */
  .pw-tabs{
    display:flex;gap:10px;overflow:auto;
    padding: 14px 0 8px;
    scrollbar-width: thin;
  }
  .pw-tab{
    border: 2px solid var(--border);
    background:#fff;
    padding: 12px 18px;
    border-radius: 16px;
    font-weight:800;
    font-size:22px;
    color:#0f172a;
    white-space:nowrap;
    cursor:pointer;
  }
  .pw-tab.is-active{
    background: var(--blue-weak);
    border-color:#1e4e8c;
    color:#1e4e8c;
  }

  /* Cards */
  .pw-card{
    background: var(--card);
    border-radius: 22px;
    padding: 18px;
    border: 1px solid #eef0f3;
  }

  /* Summary */
  .pw-summary{margin-top: 14px;}
  .pw-summary-top{ text-align:center; padding: 8px 0 16px;}
  .pw-label{font-size:18px;color:var(--muted);font-weight:700;}
  .pw-net{font-size:56px;line-height:1;margin-top:10px;color:var(--green);font-weight:900;letter-spacing:-0.02em;}
  .pw-summary-bottom{
    display:grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 16px;
    background: var(--card2);
    border-radius: 18px;
    padding: 18px;
  }
  .pw-metric{text-align:center;}
  .pw-value{font-size:32px;font-weight:900;margin-top:8px;}
  .pw-divider{width:1px;background: #e6e8ee; border-radius:1px;}

  /* Section title */
  .pw-section-title{
    font-size: 28px;
    margin: 18px 0 12px;
    font-weight: 900;
    letter-spacing: -0.01em;
  }

  /* List */
  .pw-list{padding: 12px 10px;}
  .pw-row{
    display:grid;
    grid-template-columns: 38px 1fr auto 28px;
    align-items:center;
    gap: 12px;
    padding: 16px 12px;
    text-decoration:none;
    color: inherit;
    border-radius: 16px;
  }
  .pw-row:hover{background:#ffffff;}
  .pw-row-divider{height:1px;background:#e7e9ef;margin: 0 14px;}
  .pw-pdf{
    width:30px;height:30px;border-radius:8px;
    display:grid;place-items:center;
    color:#d86b2d;background:#fff;border:1px solid #f2d1c1;
  }
  .pw-date{font-size:24px;font-weight:900;}
  .pw-amount{font-size:26px;font-weight:900;color:var(--green);}
  .pw-chevron{color:#6b7280;display:grid;place-items:center;}

  /* Blur state */
  .payslips-widget[data-state="hidden"] .pw-content{
    filter: blur(10px);
    opacity: 0.55;
    pointer-events: none;
    user-select: none;
  }

  /* Overlay */
  .pw-overlay{
    position:absolute;inset:0;
    display:none;
    padding: 22px;
  }
  .payslips-widget[data-state="hidden"] .pw-overlay{
    display:grid;
    place-items:center;
  }
  .pw-overlay-inner{
    text-align:center;
    display:grid;
    gap: 18px;
    place-items:center;
  }
  .pw-overlay-title{font-size:30px;font-weight:900;letter-spacing:-0.01em;}
  .pw-overlay-subtitle{font-size:30px;font-weight:900;letter-spacing:-0.01em;margin-top:-6px;}
  .pw-overlay-btn{
    width:88px;height:88px;border-radius:999px;
    background: var(--blue);
    border: 4px solid #0e3e73;
    color:#0e3e73;
    display:grid;place-items:center;
    cursor:pointer;
    box-shadow: 0 10px 26px rgba(0,0,0,0.12);
  }
  .pw-overlay-btn svg{stroke:#0e3e73;}
</style>

<script>
  (function () {
    const widget = document.currentScript?.previousElementSibling?.previousElementSibling?.previousElementSibling
      ?.classList?.contains("payslips-widget")
      ? document.currentScript.previousElementSibling.previousElementSibling.previousElementSibling
      : document.querySelector(".payslips-widget");

    if (!widget) return;

    const data = {
      june2020: {
        net: 5250.91,
        gross: 7430.00,
        deductions: 2179.09,
        payslips: [
          { date: "30/06/2020", amount: 2625.45 },
          { date: "15/06/2020", amount: 2625.46 }
        ]
      },
      may2020: {
        net: 4988.12,
        gross: 7200.00,
        deductions: 2211.88,
        payslips: [
          { date: "29/05/2020", amount: 2494.06 },
          { date: "15/05/2020", amount: 2494.06 }
        ]
      },
      apr2020: {
        net: 5122.40,
        gross: 7350.00,
        deductions: 2227.60,
        payslips: [
          { date: "30/04/2020", amount: 2561.20 },
          { date: "15/04/2020", amount: 2561.20 }
        ]
      },
      mar2020: {
        net: 4760.33,
        gross: 7000.00,
        deductions: 2239.67,
        payslips: [
          { date: "31/03/2020", amount: 2380.17 },
          { date: "16/03/2020", amount: 2380.16 }
        ]
      }
    };

    const bind = {
      net: widget.querySelector('[data-bind="net"]'),
      gross: widget.querySelector('[data-bind="gross"]'),
      deductions: widget.querySelector('[data-bind="deductions"]'),
      list: widget.querySelector('[data-bind="list"]')
    };

    const tabs = Array.from(widget.querySelectorAll(".pw-tab"));
    const toggleBtn = widget.querySelector(".pw-privacy-toggle");
    const overlayBtn = widget.querySelector(".pw-overlay-btn");
    const overlay = widget.querySelector(".pw-overlay");
    const privacyText = widget.querySelector(".pw-privacy-text");
    const eye = widget.querySelector(".pw-eye");

    const fmt = (n) =>
      n.toLocaleString(undefined, { style: "currency", currency: "USD" });

    function renderMonth(key) {
      const m = data[key];
      if (!m) return;

      if (bind.net) bind.net.textContent = fmt(m.net);
      if (bind.gross) bind.gross.textContent = fmt(m.gross);
      if (bind.deductions) bind.deductions.textContent = fmt(m.deductions);

      if (bind.list) {
        bind.list.innerHTML = m.payslips
          .map((p, idx) => `
            <a class="pw-row" href="javascript:void(0)">
              <span class="pw-pdf" aria-hidden="true">
                <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                  <path d="M14 2v6h6"></path>
                  <path d="M8 13h3"></path>
                  <path d="M8 17h8"></path>
                </svg>
              </span>
              <span class="pw-date">${p.date}</span>
              <span class="pw-amount">${fmt(p.amount)}</span>
              <span class="pw-chevron" aria-hidden="true">
                <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 18l6-6-6-6"></path>
                </svg>
              </span>
            </a>
            ${idx < m.payslips.length - 1 ? '<div class="pw-row-divider" aria-hidden="true"></div>' : ''}
          `)
          .join("");
      }
    }

    function setActiveTab(nextKey) {
      tabs.forEach((t) => {
        const on = t.dataset.month === nextKey;
        t.classList.toggle("is-active", on);
        t.setAttribute("aria-selected", on ? "true" : "false");
      });
      renderMonth(nextKey);
    }

    function setState(next) {
      widget.setAttribute("data-state", next);
      const hidden = next === "hidden";

      if (privacyText) privacyText.textContent = hidden ? "Tap to view" : "Tap to hide";
      if (toggleBtn) toggleBtn.setAttribute("aria-label", hidden ? "View payslips" : "Hide payslips");

      if (eye) {
        eye.style.background = hidden ? "var(--blue)" : "var(--blue-weak)";
      }
    }

    function togglePrivacy() {
      const curr = widget.getAttribute("data-state") || "hidden";
      setState(curr === "hidden" ? "visible" : "hidden");
    }

    // Events
    tabs.forEach((t) => {
      t.addEventListener("click", () => setActiveTab(t.dataset.month));
    });

    toggleBtn?.addEventListener("click", togglePrivacy);
    overlayBtn?.addEventListener("click", togglePrivacy);
    overlay?.addEventListener("click", (e) => {
      if (e.target === overlay) togglePrivacy();
    });

    // Init: start hidden + load active month (June)
    setState("hidden");
    setActiveTab("june2020");
  })();
</script>
